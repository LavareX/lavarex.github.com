<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>添加约束的恰当时机 | Lavare</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">添加约束的恰当时机</h1><a id="logo" href="/.">Lavare</a><p class="description">Review myself</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">添加约束的恰当时机</h1><div class="post-meta">Dec 5, 2016</div><a data-disqus-identifier="2016/12/05/添加约束的恰当时机/" href="/2016/12/05/添加约束的恰当时机/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Interface-Builder-实现"><span class="toc-number">1.</span> <span class="toc-text">Interface Builder 实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码实现"><span class="toc-number">2.</span> <span class="toc-text">代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#注意事项"><span class="toc-number">2.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考"><span class="toc-number">3.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="post-content"><p>总的来说，在 iOS 开发中添加约束有 2 种方式，通过 Interface Builder 的界面拖拽添加，或者手写代码添加。</p>
<h3 id="Interface-Builder-实现"><a href="#Interface-Builder-实现" class="headerlink" title="Interface Builder 实现"></a>Interface Builder 实现</h3><p>在 Interface Builder 下只能通过界面添加，所以无需考虑添加的时机。</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><ol>
<li>初始化的约束设置在 <code>- (void)viewDidLoad</code> 方法中添加</li>
<li>后期需要修改更新的约束设置则在 <code>- (void)updateConstraints</code> 方法中添加</li>
</ol>
<p>关于第一点的说法在 <a href="https://developer.apple.com/videos/play/wwdc2015/219/?time=269">WWDC 2015 的 Session 219 - Mysteries of Auto Layout, Part 2</a> 中有提到：</p>
<blockquote>
<p>All of your initial constraint setup should ideally happen inside Interface Builder.<br>Or if you really find that you need to allocate your constraints programmatically, some place like viewDidLoad is much better.</p>
</blockquote>
<p>第二点的说法则在 <code>- (void)updateConstraints</code> 的<a href="https://developer.apple.com/reference/uikit/uiview/1622512-updateconstraints">文档</a>中有提到：</p>
<blockquote>
<p>Override this method to optimize changes to your constraints.<br>……<br>Your implementation must be as efficient as possible. Do not deactivate all your constraints, then reactivate the ones you need. Instead, your app must have some way of tracking your constraints, and validating them during each update pass. Only change items that need to be changed. During each update pass, you must ensure that you have the appropriate constraints for the app’s current state.</p>
</blockquote>
<p>大概的意思就是当需要修改约束时，保留待修改的约束的引用，在该方法中的合适时机进行修改。</p>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>若全部的约束都是写在 <code>- (void)updateConstraints</code> 方法中的话，需要额外设置 <code>UIView</code> 的 <code>requiresConstraintBasedLayout</code> 属性为 <code>YES</code>。<br>因为当代码全部写在 <code>- (void)updateConstraints</code> 方法中时，系统是不知道当前 <code>View</code> 是否采用约束的方式来布局，所以就不会调用 <code>- (void)updateConstraints</code> 方法，所以为了解决「先有鸡还是先有蛋」的问题，把 <code>requiresConstraintBasedLayout</code> 属性设置为 <code>YES</code>，以告诉系统该 <code>View</code> 采用约束的方式来布局。<br>这个比较坑，在文档中并没有提及到，但是在 <code>UIView</code> 的头文件（打开 Xcode，按下快捷键「⇧⌘O」后，输入 <code>requiresConstraintBasedLayout</code>）中可以找到：</p>
<blockquote>
<p>constraint-based layout engages lazily when someone tries to use it (e.g., adds a constraint to a view).  If you do all of your constraint set up in -updateConstraints, you might never even receive updateConstraints if no one makes a constraint.  To fix this chicken and egg problem, override this method to return YES if your view needs the window to use constraint-based layout.</p>
</blockquote>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://www.edwardhuynh.com/blog/2013/11/24/the-mystery-of-the-requiresconstraintbasedlayout/">The Mystery of the +requiresConstraintBasedLayout - TIL by Ed</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2015/219/?time=269">Mysteries of Auto Layout, Part 2 - WWDC 2015 - Videos - Apple Developer</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yangcaimu.github.io/2016/12/05/添加约束的恰当时机/" data-id="cj92l9nyw000hc2uz9p8arq9r" class="article-share-link">分享到</a><div class="tags"><a href="/tags/iOS/">iOS</a><a href="/tags/Constraint/">Constraint</a></div><div class="post-nav"><a href="/2017/10/22/读-SDWebImage-源码小记/" class="pre">读 SDWebImage 源码小记</a><a href="/2016/07/12/写作本身的一些参考资料/" class="next">写作本身的一些参考资料</a></div><div id="disqus_thread"><script>var disqus_shortname = 'yangcaimu-blog';
var disqus_identifier = '2016/12/05/添加约束的恰当时机/';
var disqus_title = '添加约束的恰当时机';
var disqus_url = 'http://yangcaimu.github.io/2016/12/05/添加约束的恰当时机/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//yangcaimu-blog.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yangcaimu.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Skills/" style="font-size: 15px;">Skills</a> <a href="/tags/Alfred/" style="font-size: 15px;">Alfred</a> <a href="/tags/Workflow/" style="font-size: 15px;">Workflow</a> <a href="/tags/Xcode/" style="font-size: 15px;">Xcode</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/写作/" style="font-size: 15px;">写作</a> <a href="/tags/Constraint/" style="font-size: 15px;">Constraint</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/Octopress/" style="font-size: 15px;">Octopress</a> <a href="/tags/SDWebImage/" style="font-size: 15px;">SDWebImage</a> <a href="/tags/源码解析/" style="font-size: 15px;">源码解析</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/22/读-SDWebImage-源码小记/">读 SDWebImage 源码小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/05/添加约束的恰当时机/">添加约束的恰当时机</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/12/写作本身的一些参考资料/">写作本身的一些参考资料</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/09/Alfred-workflow-快速打开-Xcode-工程/">Alfred workflow: 快速打开 Xcode 工程</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/05/25/windowshiyongjiqiao/">Windows 使用技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/05/24/macshiyongjiqiao/">Mac 使用技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/04/25/dajianblogzhilu/">搭建 Blog 之旅</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Lavare.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-51815558-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f2332cdab78cfdaaf85ad19f83bb65b1";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>